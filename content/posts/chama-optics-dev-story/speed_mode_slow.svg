<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 860 570">
  <defs>
    <marker id="arrow-b3" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#4A90D9"/>
    </marker>
    <marker id="arrow-g3" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#7CB342"/>
    </marker>
    <marker id="arrow-o3" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#FF9800"/>
    </marker>
    <marker id="arrow-p3" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#AB47BC"/>
    </marker>
    <style>
      text { font-family: 'Inter', 'Helvetica Neue', 'Arial', sans-serif; }
      .title { font-size: 18px; font-weight: bold; fill: #1a1a1a; }
      .subtitle { font-size: 13px; fill: #666; }
      .label { font-size: 12px; fill: #333; }
      .label-sm { font-size: 11px; fill: #555; }
      .label-bold { font-size: 12px; fill: #333; font-weight: bold; }
      .step-num { font-size: 12px; font-weight: bold; fill: white; }
      .time { font-size: 14px; font-weight: bold; fill: #7B1FA2; }
    </style>
  </defs>

  <!-- Background -->
  <rect width="860" height="570" rx="8" fill="#fafafa" stroke="#e0e0e0" stroke-width="1"/>

  <!-- Title -->
  <text x="430" y="32" text-anchor="middle" class="title">Speed Mode: Slow (max_depth = 2)</text>
  <text x="430" y="52" text-anchor="middle" class="subtitle">40-50 person group | 2560x2560 + 1280x1280 multi-depth windows</text>

  <!-- Original Image -->
  <rect x="40" y="75" width="360" height="240" rx="4" fill="#e8eef5" stroke="#b0bec5" stroke-width="1.5"/>

  <!-- Step 1: Whole (blue) -->
  <rect x="40" y="75" width="360" height="240" rx="4" fill="#4A90D9" fill-opacity="0.05" stroke="#4A90D9" stroke-width="1.2" stroke-dasharray="8,4"/>
  <circle cx="55" cy="90" r="10" fill="#4A90D9"/>
  <text x="55" y="94" text-anchor="middle" class="step-num">1</text>

  <!-- Step 2: Short-side (green) -->
  <rect x="43" y="78" width="236" height="234" rx="3" fill="#7CB342" fill-opacity="0.05" stroke="#7CB342" stroke-width="1.2" stroke-dasharray="5,3"/>
  <rect x="160" y="78" width="237" height="234" rx="3" fill="#7CB342" fill-opacity="0.05" stroke="#7CB342" stroke-width="1.2" stroke-dasharray="5,3"/>
  <circle cx="55" cy="112" r="10" fill="#7CB342"/>
  <text x="55" y="116" text-anchor="middle" class="step-num">2</text>

  <!-- Step 3: 2560x2560 windows (orange) - depth level 0 -->
  <!-- 2560 in SVG = 360*(2560/6000) ≈ 153.6 -->
  <rect x="44" y="79" width="154" height="154" rx="2" fill="#FF9800" fill-opacity="0.10" stroke="#FF9800" stroke-width="1.5"/>
  <rect x="185" y="79" width="154" height="154" rx="2" fill="#FF9800" fill-opacity="0.08" stroke="#FF9800" stroke-width="1.5" stroke-dasharray="4,2"/>
  <rect x="44" y="152" width="154" height="154" rx="2" fill="#FF9800" fill-opacity="0.06" stroke="#FF9800" stroke-width="1" stroke-dasharray="4,2"/>
  <text x="330" y="162" class="label-sm" fill="#FF9800">...</text>
  <circle cx="55" cy="134" r="10" fill="#FF9800"/>
  <text x="55" y="138" text-anchor="middle" class="step-num">3</text>

  <!-- Step 4: 1280x1280 windows (purple) - depth level 1 -->
  <!-- 1280 in SVG ≈ 76.8 -->
  <rect x="240" y="160" width="77" height="77" rx="2" fill="#AB47BC" fill-opacity="0.12" stroke="#AB47BC" stroke-width="1.2"/>
  <rect x="305" y="160" width="77" height="77" rx="2" fill="#AB47BC" fill-opacity="0.08" stroke="#AB47BC" stroke-width="1" stroke-dasharray="3,2"/>
  <rect x="240" y="228" width="77" height="77" rx="2" fill="#AB47BC" fill-opacity="0.08" stroke="#AB47BC" stroke-width="1" stroke-dasharray="3,2"/>
  <text x="365" y="220" class="label-sm" fill="#AB47BC">...</text>
  <circle cx="233" cy="164" r="10" fill="#AB47BC"/>
  <text x="233" y="168" text-anchor="middle" class="step-num">4</text>

  <text x="180" y="250" text-anchor="middle" class="label" fill="#78909c">6000 x 4000</text>

  <!-- Pipeline steps (right side) -->
  <text x="440" y="95" class="label-sm" fill="#4A90D9">Step 1: Whole → 640x640</text>
  <text x="440" y="118" class="label-sm" fill="#7CB342">Step 2: Short-side → 640x640 x N</text>
  <text x="440" y="142" class="label-sm" fill="#FF9800">Step 3: 2560x2560 → 640x640 x few</text>
  <text x="440" y="166" class="label-sm" fill="#AB47BC">Step 4: 1280x1280 → 640x640 x tens</text>

  <!-- Arrow to ONNX -->
  <line x1="440" y1="180" x2="440" y2="205" stroke="#666" stroke-width="1" stroke-dasharray="3,2"/>

  <!-- ONNX box -->
  <rect x="440" y="210" width="370" height="100" rx="6" fill="#f5f5f5" stroke="#9e9e9e" stroke-width="1.5"/>
  <text x="625" y="238" text-anchor="middle" class="label-bold">ONNX Inference (InsightFace SCRFD det_10g)</text>
  <text x="625" y="258" text-anchor="middle" class="label-sm">Resize each window to 640x640 → inference → coord transform</text>
  <line x1="480" y1="270" x2="770" y2="270" stroke="#e0e0e0" stroke-width="1"/>
  <text x="625" y="290" text-anchor="middle" class="label-sm">Final NMS (IoU 0.4) → remove duplicates in full image coords</text>

  <!-- Depth explanation -->
  <rect x="440" y="330" width="370" height="90" rx="6" fill="#F3E5F5" stroke="#7B1FA2" stroke-width="1" stroke-dasharray="5,3"/>
  <text x="460" y="352" class="label-bold" fill="#7B1FA2">Depth Loop (max_depth=2):</text>
  <text x="460" y="372" class="label-sm">Level 0: <tspan font-weight="bold" fill="#FF9800">2560x2560</tspan> windows (coarse)</text>
  <text x="460" y="392" class="label-sm">Level 1: <tspan font-weight="bold" fill="#AB47BC">1280x1280</tspan> windows (medium)</text>
  <text x="460" y="412" class="label-sm" fill="#999">Large windows (2560) → medium windows (1280) progressive refinement</text>

  <!-- Result summary -->
  <rect x="40" y="495" width="780" height="55" rx="6" fill="#F3E5F5" stroke="#7B1FA2" stroke-width="1"/>
  <text x="60" y="518" class="label-bold" fill="#7B1FA2">Slow</text>
  <text x="100" y="518" class="label">: 2560→1280 multi-depth search. Detects both mid-range and distant faces.</text>
  <text x="60" y="538" class="time">Avg ~13s</text>
  <text x="175" y="538" class="label-sm">| Ideal for 40-50 person groups | 2-level depth loop</text>

  <!-- Legend -->
  <rect x="40" y="450" width="13" height="11" rx="2" fill="#4A90D9" fill-opacity="0.15" stroke="#4A90D9" stroke-width="1"/>
  <text x="58" y="460" class="label-sm">Whole</text>
  <rect x="95" y="450" width="13" height="11" rx="2" fill="#7CB342" fill-opacity="0.15" stroke="#7CB342" stroke-width="1"/>
  <text x="113" y="460" class="label-sm">Short-side</text>
  <rect x="160" y="450" width="13" height="11" rx="2" fill="#FF9800" fill-opacity="0.15" stroke="#FF9800" stroke-width="1.5"/>
  <text x="178" y="460" class="label-sm">2560x2560</text>
  <rect x="255" y="450" width="13" height="11" rx="2" fill="#AB47BC" fill-opacity="0.15" stroke="#AB47BC" stroke-width="1.5"/>
  <text x="273" y="460" class="label-sm">1280x1280</text>
</svg>
