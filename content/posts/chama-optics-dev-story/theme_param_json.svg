<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 920 520">
  <defs>
    <marker id="ar-tp" markerWidth="8" markerHeight="6" refX="7" refY="3" orient="auto">
      <polygon points="0 0, 8 3, 0 6" fill="#546E7A"/>
    </marker>
    <marker id="ar-tp-r" markerWidth="8" markerHeight="6" refX="7" refY="3" orient="auto">
      <polygon points="0 0, 8 3, 0 6" fill="#ce422b"/>
    </marker>
    <marker id="ar-tp-b" markerWidth="8" markerHeight="6" refX="7" refY="3" orient="auto">
      <polygon points="0 0, 8 3, 0 6" fill="#1565C0"/>
    </marker>
    <marker id="ar-tp-g" markerWidth="8" markerHeight="6" refX="7" refY="3" orient="auto">
      <polygon points="0 0, 8 3, 0 6" fill="#2E7D32"/>
    </marker>
    <style>
      text { font-family: 'Inter', 'Helvetica Neue', 'Arial', sans-serif; }
      .title { font-size: 17px; font-weight: bold; fill: #1a1a1a; }
      .subtitle { font-size: 12px; fill: #666; }
      .label { font-size: 12px; fill: #333; }
      .label-sm { font-size: 10.5px; fill: #555; }
      .label-xs { font-size: 9.5px; fill: #777; }
      .label-bold { font-size: 12px; fill: #333; font-weight: bold; }
      .code-sm { font-family: 'JetBrains Mono', 'SF Mono', monospace; font-size: 9px; fill: #546E7A; }
      .code-md { font-family: 'JetBrains Mono', 'SF Mono', monospace; font-size: 10px; fill: #546E7A; }
    </style>
  </defs>

  <rect width="920" height="520" rx="8" fill="#fafafa" stroke="#e0e0e0" stroke-width="1"/>

  <!-- Title -->
  <text x="460" y="28" text-anchor="middle" class="title">Theme Parameter System: Rust → JSON → Platform UI</text>
  <text x="460" y="46" text-anchor="middle" class="subtitle">proc_macro derives JSON schema from Rust structs — mobile generates UI, egui renders directly</text>

  <!-- ===== Left: Rust Struct Definition ===== -->
  <rect x="25" y="65" width="260" height="220" rx="6" fill="#FFEBEE" stroke="#ce422b" stroke-width="1.2"/>
  <text x="155" y="85" text-anchor="middle" class="label-bold" fill="#ce422b">Rust Struct (Single Source of Truth)</text>

  <!-- Code block -->
  <rect x="35" y="95" width="240" height="175" rx="4" fill="#2d2d2d"/>
  <text x="45" y="113" class="code-md" fill="#C792EA">#[derive(ThemeParam)]</text>
  <text x="45" y="128" class="code-md" fill="#C792EA">pub struct</text>
  <text x="117" y="128" class="code-md" fill="#FFCB6B"> FrameConfig</text>
  <text x="200" y="128" class="code-md" fill="#89DDFF"> {</text>

  <text x="55" y="148" class="code-md" fill="#546E7A">/// slider(100..=900)</text>
  <text x="55" y="163" class="code-md" fill="#F07178">font_weight</text>
  <text x="133" y="163" class="code-md" fill="#89DDFF">:</text>
  <text x="140" y="163" class="code-md" fill="#FFCB6B"> u16</text>
  <text x="157" y="163" class="code-md" fill="#89DDFF">,</text>

  <text x="55" y="183" class="code-md" fill="#546E7A">/// toggle</text>
  <text x="55" y="198" class="code-md" fill="#F07178">show_logo</text>
  <text x="127" y="198" class="code-md" fill="#89DDFF">:</text>
  <text x="134" y="198" class="code-md" fill="#FFCB6B"> bool</text>
  <text x="158" y="198" class="code-md" fill="#89DDFF">,</text>

  <text x="55" y="218" class="code-md" fill="#546E7A">/// enum_select</text>
  <text x="55" y="233" class="code-md" fill="#F07178">theme</text>
  <text x="91" y="233" class="code-md" fill="#89DDFF">:</text>
  <text x="98" y="233" class="code-md" fill="#FFCB6B"> ThemeKind</text>
  <text x="166" y="233" class="code-md" fill="#89DDFF">,</text>

  <text x="55" y="253" class="code-md" fill="#546E7A">// ... 40+ fields</text>
  <text x="45" y="265" class="code-md" fill="#89DDFF">}</text>

  <!-- ===== Center: proc_macro ===== -->
  <rect x="310" y="85" width="195" height="85" rx="6" fill="#F3E5F5" stroke="#7B1FA2" stroke-width="1.5"/>
  <text x="407" y="108" text-anchor="middle" class="label-bold" fill="#7B1FA2">proc_macro</text>
  <text x="407" y="125" text-anchor="middle" class="code-md" fill="#7B1FA2">#[derive(ThemeParam)]</text>
  <text x="407" y="145" text-anchor="middle" class="label-xs" fill="#7B1FA2">Compile-time code generation</text>
  <text x="407" y="160" text-anchor="middle" class="label-xs" fill="#7B1FA2">struct → JSON schema + FFI + UI hints</text>

  <!-- Arrow: Struct → proc_macro -->
  <line x1="285" y1="128" x2="305" y2="128" stroke="#ce422b" stroke-width="1.5" marker-end="url(#ar-tp-r)"/>

  <!-- ===== Generated outputs ===== -->

  <!-- Output 1: JSON Schema -->
  <rect x="310" y="195" width="195" height="70" rx="4" fill="#FFF8E1" stroke="#FFC107" stroke-width="1"/>
  <text x="407" y="215" text-anchor="middle" class="label-bold" fill="#F57F17">JSON Schema</text>
  <text x="407" y="232" text-anchor="middle" class="code-sm" fill="#F57F17">{ "font_weight": {</text>
  <text x="407" y="244" text-anchor="middle" class="code-sm" fill="#F57F17">  "type":"slider","min":100,</text>
  <text x="407" y="256" text-anchor="middle" class="code-sm" fill="#F57F17">  "max":900,"default":400 }}</text>

  <!-- Arrow: proc_macro → JSON -->
  <line x1="407" y1="170" x2="407" y2="190" stroke="#7B1FA2" stroke-width="1.5" marker-end="url(#ar-tp)"/>

  <!-- Output 2: Direct egui access -->
  <rect x="310" y="285" width="195" height="50" rx="4" fill="#E3F2FD" stroke="#1565C0" stroke-width="1"/>
  <text x="407" y="305" text-anchor="middle" class="label-bold" fill="#1565C0">Direct Struct Access</text>
  <text x="407" y="322" text-anchor="middle" class="code-sm" fill="#1565C0">config.font_weight = 700;</text>

  <!-- Arrow: proc_macro → Direct -->
  <line x1="380" y1="170" x2="380" y2="280" stroke="#7B1FA2" stroke-width="1" stroke-dasharray="4,2" marker-end="url(#ar-tp)"/>

  <!-- Output 3: FFI Functions -->
  <rect x="310" y="355" width="195" height="50" rx="4" fill="#FFF3E0" stroke="#E65100" stroke-width="1"/>
  <text x="407" y="373" text-anchor="middle" class="label-bold" fill="#E65100">Auto-generated FFI</text>
  <text x="407" y="390" text-anchor="middle" class="code-sm" fill="#E65100">get_param_json() / set_param()</text>

  <!-- Arrow: proc_macro → FFI -->
  <line x1="435" y1="170" x2="435" y2="350" stroke="#7B1FA2" stroke-width="1" stroke-dasharray="4,2" marker-end="url(#ar-tp)"/>

  <!-- ===== Right Top: Mobile ===== -->
  <rect x="550" y="65" width="345" height="210" rx="6" fill="#E8F5E9" stroke="#2E7D32" stroke-width="1.2"/>
  <text x="722" y="85" text-anchor="middle" class="label-bold" fill="#2E7D32">Mobile (iOS / Android)</text>

  <!-- iOS box -->
  <rect x="565" y="95" width="150" height="85" rx="4" fill="white" stroke="#A5D6A7"/>
  <text x="640" y="115" text-anchor="middle" class="label-sm" fill="#1565C0">iOS (SwiftUI)</text>
  <text x="640" y="132" text-anchor="middle" class="code-sm">JSON → Slider {</text>
  <text x="640" y="144" text-anchor="middle" class="code-sm">  value: $fontWeight,</text>
  <text x="640" y="156" text-anchor="middle" class="code-sm">  in: 100...900</text>
  <text x="640" y="168" text-anchor="middle" class="code-sm">}</text>

  <!-- Android box -->
  <rect x="730" y="95" width="150" height="85" rx="4" fill="white" stroke="#A5D6A7"/>
  <text x="805" y="115" text-anchor="middle" class="label-sm" fill="#2E7D32">Android (Compose)</text>
  <text x="805" y="132" text-anchor="middle" class="code-sm">JSON → Slider(</text>
  <text x="805" y="144" text-anchor="middle" class="code-sm">  value = fontWeight,</text>
  <text x="805" y="156" text-anchor="middle" class="code-sm">  valueRange = 100f..900f</text>
  <text x="805" y="168" text-anchor="middle" class="code-sm">)</text>

  <!-- Mobile flow description -->
  <rect x="565" y="190" width="315" height="42" rx="3" fill="#C8E6C9" stroke="#2E7D32" stroke-width="1"/>
  <text x="722" y="207" text-anchor="middle" class="label-sm" fill="#2E7D32">JSON schema → parse → generate native UI elements</text>
  <text x="722" y="222" text-anchor="middle" class="label-xs" fill="#2E7D32">Rust struct field definition = UI specification</text>

  <!-- Dashed box for "no manual UI code" -->
  <rect x="565" y="240" width="315" height="24" rx="3" fill="#FFF8E1" stroke="#FFC107" stroke-width="1" stroke-dasharray="4,2"/>
  <text x="722" y="256" text-anchor="middle" class="label-xs" fill="#F57F17">New Rust field added → mobile UI automatically updated (zero manual work)</text>

  <!-- Arrow: JSON → Mobile -->
  <line x1="505" y1="230" x2="560" y2="150" stroke="#2E7D32" stroke-width="1.5" marker-end="url(#ar-tp-g)"/>
  <text x="530" y="178" text-anchor="middle" class="code-sm" fill="#2E7D32">JSON</text>

  <!-- Arrow: FFI → Mobile -->
  <line x1="505" y1="380" x2="560" y2="250" stroke="#E65100" stroke-width="1" stroke-dasharray="4,2" marker-end="url(#ar-tp)"/>

  <!-- ===== Right Bottom: Desktop ===== -->
  <rect x="550" y="290" width="345" height="115" rx="6" fill="#E3F2FD" stroke="#1565C0" stroke-width="1.2"/>
  <text x="722" y="310" text-anchor="middle" class="label-bold" fill="#1565C0">Desktop (egui)</text>

  <rect x="565" y="320" width="315" height="35" rx="4" fill="white" stroke="#BBDEFB"/>
  <text x="722" y="335" text-anchor="middle" class="code-sm" fill="#1565C0">ui.add(Slider::new(&amp;mut config.font_weight, 100..=900));</text>
  <text x="722" y="348" text-anchor="middle" class="code-sm" fill="#1565C0">ui.checkbox(&amp;mut config.show_logo, "Show Logo");</text>

  <rect x="565" y="365" width="315" height="28" rx="3" fill="#E3F2FD" stroke="#1565C0" stroke-width="1"/>
  <text x="722" y="383" text-anchor="middle" class="label-xs" fill="#1565C0">Direct Rust struct access — no JSON serialization needed</text>

  <!-- Arrow: Direct → Desktop -->
  <line x1="505" y1="310" x2="560" y2="340" stroke="#1565C0" stroke-width="1.5" marker-end="url(#ar-tp-b)"/>
  <text x="530" y="318" text-anchor="middle" class="code-sm" fill="#1565C0">Direct</text>

  <!-- ===== Bottom: Summary ===== -->
  <rect x="25" y="425" width="870" height="80" rx="6" fill="white" stroke="#e0e0e0" stroke-width="1"/>

  <text x="45" y="448" class="label-bold" fill="#7B1FA2">proc_macro generates:</text>
  <text x="220" y="448" class="label-sm">JSON schema with UI type hints (slider/toggle/enum/color picker/...)</text>
  <text x="45" y="468" class="label-bold" fill="#2E7D32">Mobile benefit:</text>
  <text x="175" y="468" class="label-sm">40+ parameters → zero manual UI code. Add a field in Rust → mobile UI appears automatically.</text>
  <text x="45" y="488" class="label-bold" fill="#1565C0">Desktop benefit:</text>
  <text x="185" y="488" class="label-sm">Same Rust struct used directly by egui — no serialization overhead, compile-time type safety.</text>
</svg>
