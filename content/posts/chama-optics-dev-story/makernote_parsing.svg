<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 900 560">
  <defs>
    <marker id="ar-d3" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#546E7A"/>
    </marker>
    <style>
      text { font-family: 'Inter', 'Helvetica Neue', 'Arial', sans-serif; }
      .title { font-size: 17px; font-weight: bold; fill: #1a1a1a; }
      .subtitle { font-size: 12px; fill: #666; }
      .label { font-size: 12px; fill: #333; }
      .label-sm { font-size: 10.5px; fill: #555; }
      .label-xs { font-size: 9.5px; fill: #777; }
      .label-bold { font-size: 12px; fill: #333; font-weight: bold; }
      .code { font-family: 'JetBrains Mono', 'SF Mono', monospace; font-size: 10px; fill: #37474F; }
      .code-sm { font-family: 'JetBrains Mono', 'SF Mono', monospace; font-size: 9px; fill: #546E7A; }
    </style>
  </defs>

  <rect width="900" height="560" rx="8" fill="#fafafa" stroke="#e0e0e0" stroke-width="1"/>

  <text x="450" y="30" text-anchor="middle" class="title">MakerNote Parsing Flow</text>
  <text x="450" y="48" text-anchor="middle" class="subtitle">Extract per-vendor shooting settings (Photo Style / LUT / Creative Look) from EXIF MakerNote</text>

  <!-- JPEG structure -->
  <rect x="30" y="68" width="240" height="240" rx="6" fill="#ECEFF1" stroke="#78909C" stroke-width="1.5"/>
  <text x="150" y="88" text-anchor="middle" class="label-bold" fill="#546E7A">JPEG File Structure</text>

  <rect x="42" y="98" width="216" height="28" rx="3" fill="#E3F2FD" stroke="#1565C0" stroke-width="1"/>
  <text x="150" y="117" text-anchor="middle" class="label-sm" fill="#1565C0">APP1 (EXIF IFD)</text>

  <rect x="55" y="132" width="190" height="28" rx="3" fill="#E8F5E9" stroke="#2E7D32" stroke-width="1"/>
  <text x="150" y="151" text-anchor="middle" class="label-sm" fill="#2E7D32">Standard EXIF Tags (Make, Model, ...)</text>

  <rect x="55" y="166" width="190" height="42" rx="3" fill="#FFF3E0" stroke="#E65100" stroke-width="1.5"/>
  <text x="150" y="183" text-anchor="middle" class="label-bold" fill="#E65100">MakerNote (Tag 0x927C)</text>
  <text x="150" y="199" text-anchor="middle" class="label-xs" fill="#E65100">Vendor-specific non-standard binary data</text>

  <rect x="42" y="215" width="216" height="28" rx="3" fill="#F3E5F5" stroke="#7B1FA2" stroke-width="1"/>
  <text x="150" y="234" text-anchor="middle" class="label-sm" fill="#7B1FA2">APP2 (MPF), Main Image Data ...</text>

  <rect x="42" y="252" width="216" height="46" rx="3" fill="#FFEBEE" stroke="#C62828" stroke-width="1"/>
  <text x="150" y="270" text-anchor="middle" class="label-sm" fill="#C62828">Inside MakerNote</text>
  <text x="150" y="288" text-anchor="middle" class="label-xs" fill="#C62828">Format differs completely per vendor!</text>

  <!-- Arrow from MakerNote to vendor detection -->
  <line x1="270" y1="187" x2="310" y2="187" stroke="#546E7A" stroke-width="2" marker-end="url(#ar-d3)"/>

  <!-- Vendor Detection -->
  <rect x="320" y="70" width="200" height="60" rx="6" fill="#FFF9C4" stroke="#F9A825" stroke-width="1.5"/>
  <text x="420" y="95" text-anchor="middle" class="label-bold" fill="#F57F17">Vendor Detection</text>
  <text x="420" y="115" text-anchor="middle" class="code-sm">exif.maker_note_vendor()</text>

  <!-- Branches -->
  <!-- Nikon -->
  <line x1="420" y1="130" x2="420" y2="155" stroke="#546E7A" stroke-width="1.5" marker-end="url(#ar-d3)"/>

  <rect x="320" y="160" width="200" height="28" rx="14" fill="#FFECB3" stroke="#F9A825" stroke-width="1"/>
  <text x="420" y="179" text-anchor="middle" class="label-sm" fill="#F57F17">MakerNoteVendor::?</text>

  <!-- Three vendor branches -->
  <!-- Nikon branch -->
  <line x1="360" y1="188" x2="140" y2="340" stroke="#E65100" stroke-width="1.5" marker-end="url(#ar-d3)"/>

  <rect x="30" y="345" width="240" height="185" rx="6" fill="#FFF3E0" stroke="#E65100" stroke-width="1.5"/>
  <text x="150" y="368" text-anchor="middle" class="label-bold" fill="#E65100">Nikon</text>

  <rect x="42" y="378" width="216" height="140" rx="3" fill="white" stroke="#FFE0B2" stroke-width="1"/>
  <text x="52" y="396" class="code-sm">PictureControlData</text>
  <text x="52" y="411" class="code-sm">PictureControlData2</text>
  <line x1="42" y1="418" x2="258" y2="418" stroke="#FFE0B2" stroke-width="1"/>
  <text x="52" y="436" class="label-sm" fill="#E65100">Extracted data:</text>
  <text x="52" y="454" class="code-sm">name: "VitalityFilm_Pmango"</text>
  <text x="52" y="470" class="label-xs">Picture Control name</text>
  <text x="52" y="486" class="label-xs">(user-defined profile name)</text>
  <text x="52" y="506" class="label-xs" fill="#999">→ MakePhotoStyle::Nikon { main }</text>

  <!-- Panasonic branch -->
  <line x1="420" y1="188" x2="420" y2="340" stroke="#2E7D32" stroke-width="1.5" marker-end="url(#ar-d3)"/>

  <rect x="290" y="345" width="260" height="185" rx="6" fill="#E8F5E9" stroke="#2E7D32" stroke-width="1.5"/>
  <text x="420" y="368" text-anchor="middle" class="label-bold" fill="#2E7D32">Panasonic (Lumix)</text>

  <rect x="302" y="378" width="236" height="140" rx="3" fill="white" stroke="#C8E6C9" stroke-width="1"/>
  <text x="312" y="396" class="code-sm">PhotoStyleName</text>
  <text x="312" y="411" class="code-sm">LutPrimaryFile / LutPrimaryGain</text>
  <text x="312" y="426" class="code-sm">LutSecondaryFile / LutSecondaryGain</text>
  <line x1="302" y1="433" x2="538" y2="433" stroke="#C8E6C9" stroke-width="1"/>
  <text x="312" y="451" class="label-sm" fill="#2E7D32">Extracted data:</text>
  <text x="312" y="467" class="code-sm">main: "NostalgicKintex"</text>
  <text x="312" y="481" class="code-sm">primary: "KintexYellow33.CUBE"</text>
  <text x="312" y="495" class="code-sm">primary_gain: 64, secondary_gain: 20</text>
  <text x="312" y="510" class="label-xs" fill="#999">→ MakePhotoStyle::Panasonic { main, luts... }</text>

  <!-- Sony branch -->
  <line x1="480" y1="188" x2="700" y2="340" stroke="#1565C0" stroke-width="1.5" marker-end="url(#ar-d3)"/>

  <rect x="590" y="345" width="240" height="185" rx="6" fill="#E3F2FD" stroke="#1565C0" stroke-width="1.5"/>
  <text x="710" y="368" text-anchor="middle" class="label-bold" fill="#1565C0">Sony</text>

  <rect x="602" y="378" width="216" height="140" rx="3" fill="white" stroke="#BBDEFB" stroke-width="1"/>
  <text x="612" y="396" class="code-sm">Sony_0x9416</text>
  <text x="612" y="411" class="code-sm">→ SonyTag9416::from_value()</text>
  <line x1="602" y1="418" x2="818" y2="418" stroke="#BBDEFB" stroke-width="1"/>
  <text x="612" y="436" class="label-sm" fill="#1565C0">Extracted data:</text>
  <text x="612" y="454" class="code-sm">creative_style: "Vivid"</text>
  <text x="612" y="470" class="label-xs">Creative Look / Creative Style</text>
  <text x="612" y="486" class="label-xs">(Standard, Vivid, Portrait...)</text>
  <text x="612" y="506" class="label-xs" fill="#999">→ MakePhotoStyle::Sony { main }</text>

  <!-- Exif-rs PR annotation -->
  <rect x="540" y="68" width="330" height="140" rx="6" fill="#FCE4EC" stroke="#AD1457" stroke-width="1" stroke-dasharray="5,3"/>
  <text x="705" y="90" text-anchor="middle" class="label-bold" fill="#AD1457">Features added via exif-rs PR #57</text>
  <line x1="560" y1="98" x2="850" y2="98" stroke="#F8BBD0" stroke-width="1"/>
  <text x="560" y="116" class="label-sm">MakerNote parsing was not available in exif-rs,</text>
  <text x="560" y="132" class="label-sm">so it was implemented and submitted as a PR.</text>
  <text x="560" y="152" class="label-xs">• MakerNote parsers for 10 vendors (+5,946 lines)</text>
  <text x="560" y="167" class="label-xs">• Extensible per-vendor module architecture</text>
  <text x="560" y="182" class="label-xs">• Extract shooting settings: Panasonic LUT,</text>
  <text x="560" y="197" class="label-xs">  Nikon PictureControl, Sony Creative Look, etc.</text>
</svg>
